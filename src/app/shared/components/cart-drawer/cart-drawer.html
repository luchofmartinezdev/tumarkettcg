<div 
  *ngIf="cartService.isOpen()" 
  (click)="close()"
  class="fixed inset-0 z-[9998] bg-black/80 backdrop-blur-sm transition-opacity duration-300">
</div>

<div 
  class="fixed right-0 top-0 z-[9999] h-screen w-full max-w-md bg-[#0a0a0a] shadow-[-10px_0_30px_rgba(0,0,0,0.5)] transition-transform duration-500 ease-in-out border-l border-white/10"
  [style.transform]="cartService.isOpen() ? 'translateX(0)' : 'translateX(100%)'"
  [style.visibility]="cartService.isOpen() ? 'visible' : 'hidden'">
  
  <div class="flex h-full flex-col">
    
    <div class="flex items-center justify-between border-b border-white/5 p-6 bg-[#111]">
      <div class="flex flex-col">
        <h2 class="text-xl font-black italic uppercase text-white tracking-tighter">
          Tu <span class="text-yellow-400">Carrito</span>
        </h2>
        <span class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.2em]">
          {{ cartService.totalItems() }} productos seleccionados
        </span>
      </div>
      <button 
        (click)="close()" 
        class="flex h-10 w-10 items-center justify-center rounded-full border border-white/10 text-white transition-all hover:bg-yellow-400 hover:text-black">
        <span class="text-2xl">&times;</span>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
      
      <div *ngIf="cartService.items().length === 0" class="flex h-full flex-col items-center justify-center text-center opacity-30">
        <span class="text-6xl mb-4">ðŸ›’</span>
        <p class="text-xs font-black uppercase tracking-widest text-white">El carrito estÃ¡ vacÃ­o</p>
      </div>

      <div *ngFor="let item of cartService.items()" class="flex gap-4 rounded-xl bg-white/5 p-4 border border-white/5 transition-hover hover:border-yellow-400/30">
        <div class="h-20 w-20 shrink-0 overflow-hidden rounded-lg bg-white p-1">
          <img [src]="item.image" [alt]="item.name" class="h-full w-full object-contain">
        </div>
        
        <div class="flex flex-1 flex-col justify-between">
          <div class="flex justify-between items-start">
            <h4 class="text-[11px] font-black uppercase text-white leading-tight line-clamp-2">{{ item.name }}</h4>
            <button (click)="cartService.removeProduct(item.id)" class="text-gray-500 hover:text-red-500 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
          </div>
          
          <div class="flex items-center justify-between mt-2">
            <span class="text-[10px] font-bold text-gray-500">CANT: {{ item.quantity }}</span>
            <span class="text-sm font-black text-yellow-400 italic">
              {{ (item.price * item.quantity) | currency:'ARS':'symbol':'1.0-0' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="cartService.items().length > 0" class="border-t border-white/10 bg-[#111] p-8 space-y-6">
      <div class="space-y-2">
        <div class="flex items-center justify-between text-gray-400">
          <span class="text-[10px] font-bold uppercase tracking-widest">Subtotal</span>
          <span class="text-sm font-bold">{{ cartService.totalPrice() | currency:'ARS':'symbol':'1.0-0' }}</span>
        </div>
        <div class="flex items-center justify-between text-white">
          <span class="text-sm font-black uppercase tracking-widest">Total</span>
          <span class="text-3xl font-black italic text-yellow-400">
            {{ cartService.totalPrice() | currency:'ARS':'symbol':'1.0-0' }}
          </span>
        </div>
      </div>

      <button 
        (click)="proceedToCheckout()"
        class="w-full rounded-full bg-yellow-400 py-4 text-xs font-black uppercase italic text-black transition-all hover:bg-yellow-500 hover:shadow-[0_0_20px_rgba(250,204,21,0.4)] active:scale-95">
        Finalizar Compra
      </button>

      <div class="flex justify-center gap-4 opacity-20 grayscale">
         <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" class="h-3">
         <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" class="h-4">
         <img src="https://upload.wikimedia.org/wikipedia/commons/c/c5/Bitcoin_logo.svg" alt="Bitcoin" class="h-4">
      </div>
    </div>
  </div>
</div>

<style>
  .custom-scrollbar::-webkit-scrollbar { width: 4px; }
  .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
  .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #facd05; }
</style>